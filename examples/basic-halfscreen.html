<!doctype html>
<html>

	<head>
		<meta name='viewport' content='width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0'>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/101/three.min.js"></script>
		<script src="../dist/THREEAR.js"></script>
		<title>THREE AR Basic Pattern Marker Demo</title>
		<!-- Bind window error for error handling -->
		<script>
			// window.addEventListener('error', function(event) {
			// 	alert("ERROR: " + event.message + " at " + event.filename + " : " + event.lineno + " : " + event.colno);
			// });
		</script>
		<style>
		
			html, body, main {
				width: 100%;
				height: 100%;
			}

			#ar {
				position: relative;
				height: 50vw;
				width: 50vw;
			}

		</style>
	</head>

	<body style='margin : 0px; overflow: hidden; font-family: Monospace;'>
		<main>
			<div>
				<h1> Some content could go here </h1>
			</div>
			<div id="ar">

			</div>
			<div>
				<h1> You can put some other content in here </h1>
			</div>
		</main>
		<script>
						
			var renderer = new THREE.WebGLRenderer({
				// antialias	: true,
				alpha: true
			});
			renderer.setClearColor(new THREE.Color('lightgrey'), 0)
			// renderer.setPixelRatio( 2 );
			renderer.setSize( window.innerWidth, window.innerHeight );
			var arDiv = document.getElementById("ar");
			arDiv.appendChild(renderer.domElement);
		
			// init scene and camera
			var scene = new THREE.Scene();
			var camera = new THREE.Camera();
			scene.add(camera);

			var markerGroup = new THREE.Group();
			scene.add(markerGroup);
		
			var source = new THREEAR.Source({
				parent: arDiv,
				renderer: renderer,
				camera: camera
			});

			THREEAR.initialize({ source: source }).then((controller) => {

				// add a torus knot		
				var geometry = new THREE.TorusKnotGeometry(0.3,0.1,64,16);
				var material = new THREE.MeshNormalMaterial(); 
				var torus = new THREE.Mesh( geometry, material );
				torus.position.y = 0.5
				markerGroup.add(torus);

				var geometry = new THREE.CubeGeometry(1,1,1);
				var material = new THREE.MeshNormalMaterial({
					transparent : true,
					opacity: 0.5,
					side: THREE.DoubleSide
				}); 
				var cube = new THREE.Mesh( geometry, material );
				cube.position.y	= geometry.parameters.height / 2;
				markerGroup.add(cube)

				var patternMarker = new THREEAR.PatternMarker({
					patternUrl: '../data/patt.hiro',
					markerObject: markerGroup
				});

				controller.trackMarker(patternMarker);

				// run the rendering loop
				var lastTimeMsec = 0;
				requestAnimationFrame(function animate(nowMsec){
					// keep looping
					requestAnimationFrame( animate );
					// measure time
					lastTimeMsec = lastTimeMsec || nowMsec-1000/60;
					var deltaMsec = Math.min(200, nowMsec - lastTimeMsec);
					lastTimeMsec = nowMsec;
					// call each update function
					controller.update( source.domElement );
					// cube.rotation.x += deltaMsec/10000 * Math.PI
					torus.rotation.y += deltaMsec/1000 * Math.PI
					torus.rotation.z += deltaMsec/1000 * Math.PI
					renderer.render( scene, camera );
				});

			});

		</script>
	</body>
	
</html>
